# FD-Java-RaspberryPi : Chapter 6 Maven

## Install Maven On Raspberry Pi

```shell
$ sudo apt install maven
```

* if Error --> Try : check version and download from web [apache](https://maven.apache.org/download.cgi)

```shell
$ wget https://dlcdn.apache.org/maven/maven-3/3.9.4/binaries/apache-maven-3.9.4-bin.tar.gz

$ pwd
/home/solokope
$ cd /opt
$ sudo tar -xzvf /home/solokope/apache-maven-3.9.4-bin.tar.gz

sudo nano /etc/profile.d/maven.sh
```

then add 

```sh
M2_HOME=/opt/apache-maven-3.9.4
PATH=$PATH:$M2_HOME/bin
```

Sava, after that : sudo reboot

```shell
$ mvn -v
Apache Maven 3.9.4 (dfbb324ad4a7c8fb0bf182e6d91b0ae20e3d2dd9)
Maven home: /opt/apache-maven-3.9.4
Java version: 13-BellSoft, vendor: BellSoft, runtime: /usr/lib/jvm/bellsoft-java13-arm32-vfp-hflt
Default locale: en_US, platform encoding: UTF-8
OS name: "linux", version: "6.1.21-v8+", arch: "arm", family: "unix"
```

## Generate a new Maven project

```shell
$ mvn archetype:generate -DgroupId=be.webtechie -DartifactId=java-maven-minimal -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false

$ cd java-maven-minimal/
$ code .
```

### Project structure
As you can see in the next screenshot, the created Maven project has a clear structure. The pom.xml
file is in the root directory. All code is in the directory structure src > main > java > be > webtechie
(based on the artifactId). There is also a unit test file available in src > test > java > be > webtechie.

### A minimal pom.xml example
Let’s take a look at the small example pom.xml file. All other available elements are described on the [Apache Maven guide](https://maven.apache.org/guides/introduction/introduction-to-the-pom.html). In the file generated by Maven itself, there is no info added, so below you can find a version with additional comments to describe the purpose of the elements.

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">  
  <modelVersion>4.0.0</modelVersion>
  
  <!-- The "project" element contains info about the layout of the document and we leave it as is. The same goes for "modelVersion". -->

  <!-- Minimum required info about this project. -->
  
  <groupId>be.webtechie</groupId>
  <artifactId>java-maven-minimal</artifactId>
  <packaging>jar</packaging>
  <version>1.0-SNAPSHOT</version>

  <!-- Info about the project.  -->

  <name>java-maven-minimal</name>
  <url>http://maven.apache.org</url>

  <!-- Define extra dependencies needed in the application. In this example the JUnit test library is added. -->

  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>3.8.1</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
</project>
```
### Maven pom-files used in this document
There are different ways to package your application into a jar-file. Depending on the fact if you want a minimal package size by providing the dependencies on the device itself, or want to include all the dependencies inside the jar so you don’t need to worry about them. Each of these options has its use-case, with the size of the jar-file as an important factor.

For ease-of-use, in the examples in this book, we will include the dependencies into the jar-file. To do this, we will use <b>"maven-assembly-plugin”</b>. Keep in mind you will need to update the “<b>mainClass</b>” value to reference the class with your main-method. The value “<b>be.webtechie.App</b>” used here, is only an example.

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.8.0</version>
            <configuration>
                <release>11</release>
            </configuration>
        </plugin>

        <plugin>
            <artifactId>maven-assembly-plugin</artifactId>
            <version>2.2.1</version>
            <configuration>
                <descriptorRefs>
                    <descriptorRef>jar-with-dependencies</descriptorRef>
                </descriptorRefs>
                <archive>
                    <manifest>
                        <addClasspath>true</addClasspath>
                        <mainClass>be.webtechie.App</mainClass>
                    </manifest>
                </archive>
            </configuration>
            <executions>
                <execution>
                    <id>make-assembly</id>
                    <phase>package</phase>
                    <goals>
                        <goal>single</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

With these plugin included in the “pom.xml”-file, we can build the application with the following command in the terminal inside your application directory:

```shell
$ mvn clean package
```
Don’t worry if this is not fully clear at this moment! In the GitHub sources of each example used in this book, you can find the correct pom-file and the generated jar-file you can run on the Pi. So you have the choice to generate the package yourself, or use the provided one. How to build and run each example is also described in the examples.


### Add application logging with Maven and log4j

[reference](https://examples.javacodegeeks.com/java-development/core-java/maven/log4j-maven-example/)